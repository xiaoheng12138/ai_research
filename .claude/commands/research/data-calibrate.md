---
description: 'æ•æ„Ÿæ€§åˆ†æä¸å‚æ•°æ ‡å®š - æ¨¡å‹å‚æ•°ä¼˜åŒ–ä¸ä¸ç¡®å®šæ€§é‡åŒ–'
---

# /data:calibrate - å‚æ•°æ ‡å®š

$ARGUMENTS

---

## ä¾èµ–èƒ½åŠ›

- `ml.train` - æ¨¡å‹è®­ç»ƒ (ç”¨æˆ·é…ç½®)
- `data.load` - æ•°æ®åŠ è½½ (ç”¨æˆ·é…ç½®)
- `data.plot` - å¯è§†åŒ– (ç”¨æˆ·é…ç½®)
- `docs.query` - SciPy ä¼˜åŒ–ç®—æ³•æ–‡æ¡£ (context7)

## æ‰§è¡Œæµç¨‹

### 1. ä¸Šä¸‹æ–‡æ£€ç´¢
- è°ƒç”¨ `mcp__ace-tool__search_context` æ£€æŸ¥ä»¿çœŸæ¨¡å‹å’Œå®éªŒæ•°æ®

### 2. å‚æ•°æ ¡éªŒ
æ£€æŸ¥è¾“å…¥æ˜¯å¦åŒ…å«:
- **ç›®æ ‡å‡½æ•°**: ä»¿çœŸæ¨¡å‹æˆ– ML æ¨¡å‹
- **æ ‡å®šå‚æ•°**: å‚æ•°åç§°ã€åˆå§‹å€¼ã€è¾¹ç•Œ
- **å®éªŒæ•°æ®**: ç”¨äºæ ¡å‡†çš„å‚è€ƒæ•°æ®
- **æ ‡å®šæ–¹æ³•**: æœ€å°äºŒä¹˜ã€è´å¶æ–¯ã€é—ä¼ ç®—æ³•

### 3. è®¡åˆ’é¢„è§ˆ

```markdown
## ğŸ“‹ æ‰§è¡Œè®¡åˆ’

| æ­¥éª¤ | æ“ä½œ | é£é™©ç­‰çº§ |
|------|------|----------|
| 1 | åŠ è½½æ¨¡å‹ä¸æ•°æ® + è·å–ä¼˜åŒ–æ–‡æ¡£ | low |
| 2 | æ•æ„Ÿæ€§åˆ†æ (å¯é€‰) | medium |
| 3 | Codex ç”Ÿæˆæ ‡å®šä»£ç  | medium |
| 4 | æ‰§è¡Œå‚æ•°ä¼˜åŒ– | high |
| 5 | ç”Ÿæˆæ ‡å®šæŠ¥å‘Š | low |

**é¢„è®¡å½±å“**:
- æ›´æ–°æ¨¡å‹å‚æ•°
- ç”Ÿæˆæ ‡å®šæŠ¥å‘Š: `artifacts/reports/calibration-report.md`
- å¯èƒ½æ¶ˆè€—å¤§é‡è®¡ç®—èµ„æº (å¤šæ¬¡è¿­ä»£)

**è­¦å‘Š**: é«˜é£é™©æ“ä½œï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤
```

### 4. ç¡®è®¤é—¨æ§
- **é£é™©ç­‰çº§**: high (å¯èƒ½ä¿®æ”¹æ¨¡å‹å‚æ•°ã€æ¶ˆè€—å¤§é‡è®¡ç®—èµ„æº)
- **è¡Œä¸º**: confirm + preview - å±•ç¤ºè®¡åˆ’ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤

### 5. æ‰§è¡Œ

#### Step 1: é¢„æ£€ç´¢ä¼˜åŒ–æ–‡æ¡£
ä½¿ç”¨ context7 è·å–ä¼˜åŒ–ç®—æ³•æœ€ä½³å®è·µ:
```javascript
mcp__context7__resolve-library-id({
  libraryName: "scipy",
  query: "scipy optimize minimize, differential evolution, basin hopping"
})

mcp__context7__query-docs({
  libraryId: "/scipy/scipy",
  query: "parameter calibration, least squares, global optimization examples"
})
```

#### Step 2: æ•æ„Ÿæ€§åˆ†æ (å¯é€‰)

**è°ƒç”¨ Codex** ç”Ÿæˆæ•æ„Ÿæ€§åˆ†æä»£ç :
```bash
C:/Users/ljh/.claude/bin/codeagent-wrapper.exe --backend codex - "$PWD" <<'EOF'
ROLE_FILE: C:/Users/ljh/.claude/.ccg/prompts/codex/architect.md
<TASK>
ä»»åŠ¡ç±»å‹: å‚æ•°æ•æ„Ÿæ€§åˆ†æ
éœ€æ±‚: åˆ†æå„å‚æ•°å¯¹ç›®æ ‡å‡½æ•°çš„æ•æ„Ÿæ€§
ä¸Šä¸‹æ–‡:
- ç›®æ ‡å‡½æ•°: [model/simulation function]
- å‚æ•°åˆ—è¡¨: [param1, param2, param3]
- å‚æ•°èŒƒå›´: [bounds]
- SciPy æ–‡æ¡£ (from context7): [SALib, Sobol indices]
åˆ†æå†…å®¹:
1. å•å‚æ•°æ‰«æ (One-at-a-time)
2. Sobol æ•æ„Ÿæ€§æŒ‡æ•° (å…¨å±€æ•æ„Ÿæ€§)
3. Morris ç­›é€‰æ³• (å‚æ•°é‡è¦æ€§æ’åº)
4. äº¤äº’æ•ˆåº”åˆ†æ
</TASK>
OUTPUT: Python è„šæœ¬ + JSON æ•æ„Ÿæ€§æŠ¥å‘Š
EOF
```

æ•æ„Ÿæ€§åˆ†æç»“æœç¤ºä¾‹:
```json
{
  "sobol_indices": {
    "first_order": {"E": 0.45, "nu": 0.25, "damping": 0.15},
    "total_order": {"E": 0.52, "nu": 0.30, "damping": 0.18}
  },
  "ranking": ["E", "nu", "damping"],
  "interaction_effects": {"E-nu": 0.08}
}
```

#### Step 3: å‚æ•°æ ‡å®š

**è°ƒç”¨ Codex** ç”Ÿæˆæ ‡å®šä»£ç :
```bash
C:/Users/ljh/.claude/bin/codeagent-wrapper.exe --backend codex - "$PWD" <<'EOF'
ROLE_FILE: C:/Users/ljh/.claude/.ccg/prompts/codex/architect.md
<TASK>
ä»»åŠ¡ç±»å‹: å‚æ•°æ ‡å®šè„šæœ¬
éœ€æ±‚: [ç”¨æˆ·æ ‡å®šéœ€æ±‚]
ä¸Šä¸‹æ–‡:
- ç›®æ ‡å‡½æ•°: [model/simulation function]
- æ ‡å®šå‚æ•°: [param1: (low, high, init), param2: ...]
- å®éªŒæ•°æ®: [exp-data-path]
- ä¼˜åŒ–ç›®æ ‡: æœ€å°åŒ– RMSE / æœ€å¤§åŒ– RÂ²
- SciPy æ–‡æ¡£ (from context7): [ä¼˜åŒ–ç®—æ³•ç¤ºä¾‹]
- æ•æ„Ÿæ€§åˆ†æç»“æœ: [è‹¥å·²æ‰§è¡Œ]
ç”Ÿæˆå†…å®¹:
1. ç›®æ ‡å‡½æ•°å®šä¹‰ (ä»¿çœŸè¯¯å·®)
2. ä¼˜åŒ–å™¨é…ç½® (differential_evolution / minimize)
3. çº¦æŸæ¡ä»¶å¤„ç†
4. è¿­ä»£è¿‡ç¨‹å¯è§†åŒ–
5. æ”¶æ•›åˆ¤æ–­ä¸æ—©åœ
6. æœ€ä¼˜å‚æ•°è¾“å‡º
</TASK>
OUTPUT: å®Œæ•´ Python è„šæœ¬
æ³¨æ„äº‹é¡¹:
1. æ”¯æŒå¤šç›®æ ‡ä¼˜åŒ–
2. è®°å½•è¿­ä»£å†å²
3. å¤„ç†çº¦æŸæ¡ä»¶
4. å¯è§†åŒ–æ”¶æ•›è¿‡ç¨‹
EOF
```

Codex è¿”å›ç¤ºä¾‹è„šæœ¬:
```python
#!/usr/bin/env python
# calibrate_model.py
# Generated by /data:calibrate

import numpy as np
import pandas as pd
from scipy.optimize import differential_evolution, minimize
from scipy.interpolate import interp1d
import matplotlib.pyplot as plt
import json

# é…ç½®
EXP_DATA_FILE = 'exp_data.csv'
PARAM_BOUNDS = {
    'E': (1.8e11, 2.2e11),      # å¼¹æ€§æ¨¡é‡
    'nu': (0.25, 0.35),          # æ³Šæ¾æ¯”
    'damping': (0.01, 0.1)       # é˜»å°¼æ¯”
}
INITIAL_GUESS = [2.0e11, 0.3, 0.05]

# åŠ è½½å®éªŒæ•°æ®
exp_data = pd.read_csv(EXP_DATA_FILE)
exp_time = exp_data['time'].values
exp_response = exp_data['response'].values

# ä»¿çœŸå‡½æ•° (ç¤ºä¾‹)
def run_simulation(params):
    """è¿è¡Œä»¿çœŸæ¨¡å‹ï¼Œè¿”å›å“åº”æ›²çº¿"""
    E, nu, damping = params
    # è¿™é‡Œè°ƒç”¨å®é™…ä»¿çœŸæ¨¡å‹
    # ç¤ºä¾‹ï¼šç®€åŒ–çš„åŠ¨åŠ›å­¦æ¨¡å‹
    omega = np.sqrt(E / 1000) * (1 - damping)
    t = np.linspace(0, 10, 1000)
    response = np.sin(omega * t) * np.exp(-damping * t)
    return t, response

# ç›®æ ‡å‡½æ•°
iteration_history = []

def objective(params):
    """è®¡ç®—ä»¿çœŸä¸å®éªŒçš„ RMSE"""
    sim_time, sim_response = run_simulation(params)

    # æ’å€¼å¯¹é½
    f_interp = interp1d(sim_time, sim_response, kind='linear', fill_value='extrapolate')
    sim_aligned = f_interp(exp_time)

    # è®¡ç®— RMSE
    rmse = np.sqrt(np.mean((sim_aligned - exp_response) ** 2))

    # è®°å½•è¿­ä»£å†å²
    iteration_history.append({
        'params': params.tolist(),
        'rmse': rmse
    })

    return rmse

# å…¨å±€ä¼˜åŒ– (differential evolution)
print("Starting global optimization...")
bounds = list(PARAM_BOUNDS.values())

result = differential_evolution(
    objective,
    bounds,
    maxiter=200,
    tol=1e-6,
    disp=True,
    workers=-1,
    updating='deferred'
)

print(f"\n=== Optimization Results ===")
print(f"Optimal parameters:")
for i, (name, value) in enumerate(zip(PARAM_BOUNDS.keys(), result.x)):
    print(f"  {name}: {value:.6e}")
print(f"Final RMSE: {result.fun:.6f}")
print(f"Iterations: {result.nit}")
print(f"Function evaluations: {result.nfev}")

# ä¿å­˜ç»“æœ
calibration_result = {
    'optimal_params': dict(zip(PARAM_BOUNDS.keys(), result.x.tolist())),
    'final_rmse': result.fun,
    'iterations': result.nit,
    'success': result.success,
    'history': iteration_history
}

with open('artifacts/reports/calibration-result.json', 'w') as f:
    json.dump(calibration_result, f, indent=2)

# å¯è§†åŒ–
fig, axes = plt.subplots(2, 2, figsize=(12, 10))

# æ”¶æ•›æ›²çº¿
rmse_history = [h['rmse'] for h in iteration_history]
axes[0, 0].plot(rmse_history)
axes[0, 0].set_xlabel('Iteration')
axes[0, 0].set_ylabel('RMSE')
axes[0, 0].set_title('Convergence Curve')
axes[0, 0].set_yscale('log')

# æ ‡å®šå‰åå¯¹æ¯”
sim_time_init, sim_response_init = run_simulation(INITIAL_GUESS)
sim_time_opt, sim_response_opt = run_simulation(result.x)

axes[0, 1].plot(exp_time, exp_response, 'k-', label='Experiment', linewidth=2)
axes[0, 1].plot(sim_time_init, sim_response_init, 'r--', label='Initial', alpha=0.7)
axes[0, 1].plot(sim_time_opt, sim_response_opt, 'b-', label='Calibrated', alpha=0.7)
axes[0, 1].set_xlabel('Time')
axes[0, 1].set_ylabel('Response')
axes[0, 1].set_title('Before vs After Calibration')
axes[0, 1].legend()

# å‚æ•°æ¢ç´¢è½¨è¿¹ (å‰ä¸¤ä¸ªå‚æ•°)
param_history = np.array([h['params'] for h in iteration_history])
axes[1, 0].scatter(param_history[:, 0], param_history[:, 1], c=range(len(param_history)), cmap='viridis', alpha=0.5)
axes[1, 0].scatter(result.x[0], result.x[1], c='red', s=100, marker='*', label='Optimal')
axes[1, 0].set_xlabel('E')
axes[1, 0].set_ylabel('nu')
axes[1, 0].set_title('Parameter Search Trajectory')
axes[1, 0].legend()

# æ®‹å·®åˆ†å¸ƒ
f_interp = interp1d(sim_time_opt, sim_response_opt, kind='linear', fill_value='extrapolate')
residuals = exp_response - f_interp(exp_time)
axes[1, 1].hist(residuals, bins=30, edgecolor='black')
axes[1, 1].set_xlabel('Residual')
axes[1, 1].set_title('Residual Distribution')

plt.tight_layout()
plt.savefig('artifacts/figures/calibration-results.png', dpi=300)
print("\nCalibration visualization saved")
```

#### Step 4: æ‰§è¡Œæ ‡å®š
```bash
python scripts/calibrate_model.py
```

#### Step 5: ç”Ÿæˆæ ‡å®šæŠ¥å‘Š

```markdown
# å‚æ•°æ ‡å®šæŠ¥å‘Š
**æ¨¡å‹**: ç»“æ„åŠ¨åŠ›å­¦ä»¿çœŸæ¨¡å‹
**ç”Ÿæˆæ—¶é—´**: 2026-01-17 10:30:00

---

## æ ‡å®šå‚æ•°
| å‚æ•° | åˆå§‹å€¼ | æ ‡å®šå€¼ | è¾¹ç•Œ | å˜åŒ–ç‡ |
|------|--------|--------|------|--------|
| E (å¼¹æ€§æ¨¡é‡) | 2.0e11 | 2.05e11 | [1.8e11, 2.2e11] | +2.5% |
| Î½ (æ³Šæ¾æ¯”) | 0.30 | 0.28 | [0.25, 0.35] | -6.7% |
| Î¾ (é˜»å°¼æ¯”) | 0.05 | 0.042 | [0.01, 0.1] | -16% |

## æ ‡å®šæ€§èƒ½
| æŒ‡æ ‡ | åˆå§‹å€¼ | æ ‡å®šå | æå‡ |
|------|--------|--------|------|
| RMSE | 0.0876 | 0.0123 | 86% |
| RÂ² | 0.8234 | 0.9876 | +20% |
| å³°å€¼è¯¯å·® | 12.3% | 2.1% | 83% |

## æ•æ„Ÿæ€§åˆ†æ
| å‚æ•° | ä¸€é˜¶æŒ‡æ•° | æ€»é˜¶æŒ‡æ•° | æ’å |
|------|----------|----------|------|
| E | 0.45 | 0.52 | 1 |
| Î½ | 0.25 | 0.30 | 2 |
| Î¾ | 0.15 | 0.18 | 3 |

## æ”¶æ•›åˆ†æ
- ä¼˜åŒ–æ–¹æ³•: Differential Evolution
- è¿­ä»£æ¬¡æ•°: 156
- å‡½æ•°è¯„ä¼°: 3,120
- æ”¶æ•›çŠ¶æ€: æˆåŠŸ

## å¯è§†åŒ–
![](artifacts/figures/calibration-results.png)

## å»ºè®®
1. E å¯¹å“åº”å½±å“æœ€å¤§ï¼Œå»ºè®®å¢åŠ æµ‹é‡ç²¾åº¦
2. é˜»å°¼æ¯”æ ‡å®šåæ˜¾è‘—é™ä½ï¼Œæ£€æŸ¥é˜»å°¼æ¨¡å‹å‡è®¾
3. è€ƒè™‘å¢åŠ éçº¿æ€§æ•ˆåº”
```

### 6. ç»“æœå‘ˆç°

```markdown
## âœ… å‚æ•°æ ‡å®šå®Œæˆ

### æ ‡å®šæ‘˜è¦
- **RMSE æå‡**: 86% (0.0876 â†’ 0.0123)
- **RÂ² æå‡**: 0.8234 â†’ 0.9876
- **æœ€æ•æ„Ÿå‚æ•°**: E (å¼¹æ€§æ¨¡é‡)

### æ ‡å®šå‚æ•°
| å‚æ•° | æ ‡å®šå€¼ |
|------|--------|
| E | 2.05e11 Pa |
| Î½ | 0.28 |
| Î¾ | 0.042 |

### ç”Ÿæˆæ–‡ä»¶
- æ ‡å®šæŠ¥å‘Š: `artifacts/reports/calibration-report.md`
- æ ‡å®šç»“æœ: `artifacts/reports/calibration-result.json`
- å¯è§†åŒ–: `artifacts/figures/calibration-results.png`

### åç»­æ“ä½œ
- æ›´æ–°ä»¿çœŸæ¨¡å‹: `/sim:modify --params calibration-result.json`
- éªŒè¯æ ‡å®šç»“æœ: `/data:compare --validate`
- ä¸ç¡®å®šæ€§é‡åŒ–: `/data:calibrate --uq bayesian`
```

---

## æ ‡å®šæ–¹æ³•

### å±€éƒ¨ä¼˜åŒ–
```bash
/data:calibrate model.py --method nelder-mead
/data:calibrate model.py --method bfgs
/data:calibrate model.py --method lm  # Levenberg-Marquardt
```

### å…¨å±€ä¼˜åŒ–
```bash
/data:calibrate model.py --method de  # Differential Evolution
/data:calibrate model.py --method basin-hopping
/data:calibrate model.py --method dual-annealing
```

### è´å¶æ–¯ä¼˜åŒ–
```bash
/data:calibrate model.py --method bayesian --n-calls 100
```

### é—ä¼ ç®—æ³•
```bash
/data:calibrate model.py --method ga --population 50 --generations 100
```

---

## æ•æ„Ÿæ€§åˆ†æ

```bash
# Sobol æŒ‡æ•°
/data:calibrate model.py --sensitivity sobol --samples 1024

# Morris ç­›é€‰
/data:calibrate model.py --sensitivity morris

# å•å‚æ•°æ‰«æ
/data:calibrate model.py --sensitivity oat --steps 20
```

---

## å¤šæ¨¡å‹åä½œ

**åä½œæ¨¡å¼**: Codex ä¸»å¯¼

| æ¨¡å‹ | èŒè´£ | è¾“å‡º |
|------|------|------|
| **Context7** | æä¾› SciPy ä¼˜åŒ–æ–‡æ¡£ | ä¼˜åŒ–ç®—æ³•æœ€ä½³å®è·µ |
| **Codex** | ç”Ÿæˆæ ‡å®šä»£ç ã€æ•æ„Ÿæ€§åˆ†æ | Python è„šæœ¬ |
| **Claude** | é¢„æ£€ç´¢æ–‡æ¡£ã€æ‰§è¡Œæ ‡å®šã€ç”ŸæˆæŠ¥å‘Š | æ ‡å®šç»“æœ + æŠ¥å‘Š |

---

## é”™è¯¯å¤„ç†

| é”™è¯¯ç±»å‹ | å¤„ç†ç­–ç•¥ |
|----------|----------|
| ä¼˜åŒ–ä¸æ”¶æ•› | è°ƒæ•´åˆå§‹å€¼æˆ–è¾¹ç•Œï¼Œå°è¯•å…¨å±€ä¼˜åŒ– |
| å±€éƒ¨æœ€ä¼˜ | ä½¿ç”¨å¤šèµ·ç‚¹ç­–ç•¥æˆ–å…¨å±€ä¼˜åŒ– |
| è®¡ç®—è¶…æ—¶ | å¢åŠ å®¹å·®ï¼Œå‡å°‘è¿­ä»£æ¬¡æ•° |
| å‚æ•°è¶Šç•Œ | æ£€æŸ¥è¾¹ç•Œè®¾ç½®ï¼Œä½¿ç”¨çº¦æŸä¼˜åŒ– |
| ä»¿çœŸå¤±è´¥ | æ·»åŠ å¼‚å¸¸å¤„ç†ï¼Œè·³è¿‡æ— æ•ˆå‚æ•°ç»„åˆ |

---

## å®‰å…¨æœºåˆ¶

1. **å‚æ•°å¤‡ä»½**: æ ‡å®šå‰ä¿å­˜åŸå§‹å‚æ•°
2. **è¾¹ç•Œæ£€æŸ¥**: å¼ºåˆ¶å‚æ•°åœ¨ç‰©ç†åˆç†èŒƒå›´å†…
3. **æ”¶æ•›ç›‘æ§**: å®æ—¶æ˜¾ç¤ºä¼˜åŒ–è¿›åº¦
4. **æ—©åœä¿æŠ¤**: è¾¾åˆ°æœ€å¤§è¿­ä»£è‡ªåŠ¨åœæ­¢
5. **ç»“æœéªŒè¯**: æ ‡å®šåè‡ªåŠ¨è¿è¡Œå¯¹æ¯”éªŒè¯

---

## å‚è€ƒ

- å…±äº«åè®®: `.claude/commands/research/_protocol.md`
- èƒ½åŠ›é…ç½®: `.claude/.research/capabilities.yaml`
- æ•°æ®å¤„ç†: `/data:process`
- ä»¿çœŸ-å®æµ‹å¯¹æ¯”: `/data:compare`
- ML è®­ç»ƒ: `/data:train`
