---
description: 'æ‰¹é‡æäº¤ ABAQUS ä»¿çœŸä½œä¸šåˆ° HPC é›†ç¾¤æˆ–æœ¬åœ°é˜Ÿåˆ—'
---

# /sim:batch - æ‰¹é‡ä»¿çœŸæäº¤

$ARGUMENTS

---

## ä¾èµ–èƒ½åŠ›

- `hpc.submit` - HPC ä½œä¸šæäº¤ (å¯é€‰, ç”¨æˆ·é…ç½®)
- `shell.run` - æœ¬åœ°å‘½ä»¤æ‰§è¡Œ (Bash)
- `docs.query` - ABAQUS ä½œä¸šç®¡ç†æ–‡æ¡£ (context7)

## æ‰§è¡Œæµç¨‹

### 1. ä¸Šä¸‹æ–‡æ£€ç´¢
- è°ƒç”¨ `mcp__ace-tool__search_context` å®šä½é¡¹ç›®ä¸­çš„ INP æ–‡ä»¶å’Œè„šæœ¬

### 2. å‚æ•°æ ¡éªŒ
æ£€æŸ¥è¾“å…¥æ˜¯å¦åŒ…å«:
- **ä½œä¸šé…ç½®**: INP æ–‡ä»¶åˆ—è¡¨æˆ–å‚æ•°æ‰«æèŒƒå›´
- **è®¡ç®—èµ„æº**: CPU æ ¸æ•°ã€å†…å­˜ã€è¿è¡Œæ—¶é—´
- **æäº¤ç›®æ ‡**: HPC é›†ç¾¤æˆ–æœ¬åœ°é˜Ÿåˆ—

### 3. è®¡åˆ’é¢„è§ˆ

```markdown
## ğŸ“‹ æ‰§è¡Œè®¡åˆ’

| æ­¥éª¤ | æ“ä½œ | é£é™©ç­‰çº§ |
|------|------|----------|
| 1 | ç”Ÿæˆä½œä¸šè„šæœ¬ (Codex) | medium |
| 2 | éªŒè¯ INP æ–‡ä»¶ | medium |
| 3 | æäº¤åˆ° HPC/æœ¬åœ°é˜Ÿåˆ— | **high** |
| 4 | è®¾ç½®ä½œä¸šç›‘æ§ | low |

**é¢„è®¡å½±å“**:
- æäº¤ä½œä¸šæ•°: [N] ä¸ª
- é¢„è®¡æ€»è¿è¡Œæ—¶é—´: [X] å°æ—¶
- è®¡ç®—èµ„æºå ç”¨: [Y] CPU æ ¸ x [Z] å°æ—¶
```

### 4. ç¡®è®¤é—¨æ§
- **é£é™©ç­‰çº§**: high (ä¼šæäº¤å¤§é‡è®¡ç®—ä½œä¸š)
- **è¡Œä¸º**: confirm + preview - è¯¦ç»†é¢„è§ˆ + æ˜¾å¼è­¦å‘Š + ç”¨æˆ·ç¡®è®¤

### 5. æ‰§è¡Œ

#### Step 1: é¢„æ£€ç´¢ ABAQUS ä½œä¸šç®¡ç†æ–‡æ¡£
ä½¿ç”¨ context7 è·å–æ‰¹é‡ä½œä¸šæœ€ä½³å®è·µ:
```javascript
mcp__context7__query-docs({
  libraryId: "/abaqus/python",
  query: "æ‰¹é‡æäº¤ ABAQUS ä½œä¸š, å‚æ•°æ‰«æ, ä½œä¸šä¾èµ–ç®¡ç†"
})
```

#### Step 2: Codex ç”Ÿæˆä½œä¸šè„šæœ¬

**è°ƒç”¨ Codex** (`run_in_background: true`):

```bash
C:/Users/ljh/.claude/bin/codeagent-wrapper.exe --backend codex - "$PWD" <<'EOF'
ROLE_FILE: C:/Users/ljh/.claude/.ccg/prompts/codex/architect.md
<TASK>
ä»»åŠ¡ç±»å‹: ABAQUS æ‰¹é‡ä½œä¸šè„šæœ¬ç”Ÿæˆ
éœ€æ±‚: [ç”¨æˆ·æ‰¹é‡æäº¤éœ€æ±‚]
ä¸Šä¸‹æ–‡:
- INP æ–‡ä»¶åˆ—è¡¨: [file1.inp, file2.inp, ...]
- å‚æ•°æ‰«æèŒƒå›´: [å‚æ•°A: 0.1-1.0, æ­¥é•¿0.1]
- è®¡ç®—èµ„æº: [4 CPU æ ¸, 16GB å†…å­˜, 24 å°æ—¶]
- æäº¤ç›®æ ‡: [HPCé›†ç¾¤ / æœ¬åœ°]
- ABAQUS ä½œä¸šç®¡ç†æ–‡æ¡£ (from context7):
  [æ‰¹é‡ä½œä¸šæœ€ä½³å®è·µ]
ç”Ÿæˆå†…å®¹:
1. ä½œä¸šæäº¤è„šæœ¬ (Bash æˆ– SLURM)
2. å‚æ•°æ‰«æé€»è¾‘ (è‹¥éœ€è¦)
3. ä½œä¸šä¾èµ–ç®¡ç† (è‹¥éœ€è¦)
4. æ—¥å¿—ä¸é”™è¯¯å¤„ç†
</TASK>
OUTPUT: Unified Diff Patch ONLY (è‹¥ä¿®æ”¹ç°æœ‰è„šæœ¬) æˆ–å®Œæ•´è„šæœ¬å†…å®¹ (è‹¥æ–°å»º)
æ³¨æ„äº‹é¡¹:
1. æ·»åŠ ä½œä¸šçŠ¶æ€æ£€æŸ¥
2. è®¾ç½®åˆç†çš„è¶…æ—¶ä¸é‡è¯•æœºåˆ¶
3. é…ç½®æ—¥å¿—è¾“å‡ºè·¯å¾„
4. æ·»åŠ èµ„æºé™åˆ¶ (é¿å…è¶…è½½)
EOF
```

ç­‰å¾… Codex è¿”å›ç¤ºä¾‹:
```bash
#!/bin/bash
# ABAQUS Batch Submission Script
# Generated by /sim:batch

# é…ç½®
ABAQUS_CMD="abaqus"
CPUS=4
MEMORY="16GB"
TIMEOUT="24h"

# ä½œä¸šåˆ—è¡¨
JOBS=(
  "model_param_0.1.inp"
  "model_param_0.2.inp"
  "model_param_0.3.inp"
  # ...
)

# æ‰¹é‡æäº¤
for job in "${JOBS[@]}"; do
  job_name="${job%.inp}"
  echo "Submitting job: $job_name"

  $ABAQUS_CMD job="$job_name" input="$job" cpus=$CPUS memory=$MEMORY interactive &

  # é™åˆ¶å¹¶å‘ä½œä¸šæ•°
  while [ $(jobs -r | wc -l) -ge 4 ]; do
    sleep 60
  done
done

echo "All jobs submitted. Monitoring..."
wait
echo "All jobs completed."
```

#### Step 3: éªŒè¯ INP æ–‡ä»¶
å¯¹æ¯ä¸ª INP æ–‡ä»¶:
```bash
abaqus datacheck job=[job-name] input=[inp-file]
```

è‹¥ datacheck å¤±è´¥:
- æ ‡è®°è¯¥ä½œä¸š
- å‘ç”¨æˆ·æŠ¥å‘Šé”™è¯¯
- è¯¢é—®æ˜¯å¦è·³è¿‡æˆ–ä¿®å¤

#### Step 4: æäº¤åˆ° HPC/æœ¬åœ°é˜Ÿåˆ—

##### HPC é›†ç¾¤ (SLURM)
è‹¥é…ç½®äº† `hpc.submit` èƒ½åŠ›:
```bash
sbatch [slurm-script]
```

ç”Ÿæˆ SLURM è„šæœ¬ç¤ºä¾‹:
```bash
#!/bin/bash
#SBATCH --job-name=abaqus-batch
#SBATCH --output=logs/abaqus-%A_%a.out
#SBATCH --array=0-9
#SBATCH --cpus-per-task=4
#SBATCH --mem=16G
#SBATCH --time=24:00:00

module load abaqus/2023

JOBS=($(ls *.inp))
INP_FILE="${JOBS[$SLURM_ARRAY_TASK_ID]}"
JOB_NAME="${INP_FILE%.inp}"

abaqus job="$JOB_NAME" input="$INP_FILE" cpus=4 interactive
```

##### æœ¬åœ°é˜Ÿåˆ—
è‹¥æ—  HPC,ä½¿ç”¨ GNU Parallel æˆ–åå°ä½œä¸š:
```bash
parallel -j 4 "abaqus job={/.} input={} cpus=4 interactive" ::: *.inp
```

#### Step 5: è®¾ç½®ä½œä¸šç›‘æ§
ç”Ÿæˆç›‘æ§è„šæœ¬:
```bash
#!/bin/bash
# monitor_jobs.sh
while true; do
  echo "=== Job Status at $(date) ==="
  squeue -u $USER  # HPC
  # æˆ– jobs -l   # æœ¬åœ°

  # æ£€æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
  if [ $(squeue -u $USER | wc -l) -eq 1 ]; then
    echo "All jobs completed!"
    break
  fi

  sleep 300  # æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
done
```

### 6. ç»“æœå‘ˆç°

```markdown
## âœ… æ‰¹é‡ä½œä¸šå·²æäº¤

### ä½œä¸šç»Ÿè®¡
- æäº¤ä½œä¸šæ•°: 10
- æˆåŠŸæäº¤: 9
- éªŒè¯å¤±è´¥: 1 (model_param_0.5.inp - ç½‘æ ¼é”™è¯¯)

### ä½œä¸šåˆ—è¡¨
| Job ID | ä½œä¸šå | çŠ¶æ€ | CPU | é¢„è®¡æ—¶é—´ |
|--------|--------|------|-----|----------|
| 12345 | model_param_0.1 | RUNNING | 4 | 2h |
| 12346 | model_param_0.2 | PENDING | 4 | 2h |
| 12347 | model_param_0.3 | RUNNING | 4 | 2h |
| ... | ... | ... | ... | ... |

### ç”Ÿæˆæ–‡ä»¶
- æäº¤è„šæœ¬: `scripts/batch_submit.sh`
- SLURM è„šæœ¬: `scripts/slurm_array.sh` (è‹¥ HPC)
- ç›‘æ§è„šæœ¬: `scripts/monitor_jobs.sh`
- æ—¥å¿—ç›®å½•: `logs/`

### ç›‘æ§å‘½ä»¤
```bash
# æŸ¥çœ‹ä½œä¸šçŠ¶æ€
squeue -u $USER                # HPC
jobs -l                        # æœ¬åœ°

# è¿è¡Œç›‘æ§è„šæœ¬
bash scripts/monitor_jobs.sh

# å–æ¶ˆä½œä¸š
scancel [job-id]               # HPC
kill [pid]                     # æœ¬åœ°
```

### åç»­æ“ä½œ
- æŸ¥çœ‹ä½œä¸šæ—¥å¿—: `tail -f logs/abaqus-*.out`
- è°ƒè¯•å¤±è´¥ä½œä¸š: `/sim:debug model_param_0.5`
- æå– ODB ç»“æœ: `/sim:odb --batch *.odb`
```

---

## å‚æ•°æ‰«æ

### å•å‚æ•°æ‰«æ
```bash
/sim:batch --sweep --param Young_Modulus --range 2e11:2.2e11:10 --template model.inp
```
ç”Ÿæˆ 10 ä¸ª INP æ–‡ä»¶,Young æ¨¡é‡ä» 2e11 åˆ° 2.2e11ã€‚

### å¤šå‚æ•°æ‰«æ
```bash
/sim:batch --sweep \
  --param E --range 2e11:2.2e11:5 \
  --param nu --range 0.25:0.35:3 \
  --template model.inp
```
ç”Ÿæˆ 5 x 3 = 15 ä¸ªä½œä¸š (ç¬›å¡å°”ç§¯)ã€‚

### ä» CSV è¯»å–å‚æ•°
```bash
/sim:batch --sweep --param-file parameters.csv --template model.inp
```

`parameters.csv` ç¤ºä¾‹:
```csv
E,nu,density
2.0e11,0.25,7850
2.1e11,0.28,7900
2.2e11,0.30,8000
```

---

## ä½œä¸šä¾èµ–

### é“¾å¼ä¾èµ–
```bash
/sim:batch --jobs job1.inp,job2.inp,job3.inp --dependency chain
```
job2 ç­‰å¾… job1 å®Œæˆ,job3 ç­‰å¾… job2 å®Œæˆã€‚

### å¹¶è¡Œ + æ±‡æ€»
```bash
/sim:batch --jobs job1.inp,job2.inp,job3.inp --dependency parallel-then summary.inp
```
job1/2/3 å¹¶è¡Œè¿è¡Œ,å…¨éƒ¨å®Œæˆåæ‰§è¡Œ summary.inpã€‚

---

## èµ„æºç®¡ç†

### è‡ªåŠ¨èµ„æºåˆ†é…
```bash
/sim:batch --auto-resources --max-cpus 16 *.inp
```
æ ¹æ® INP æ–‡ä»¶å¤§å°è‡ªåŠ¨åˆ†é… CPU æ ¸æ•°ã€‚

### é™åˆ¶å¹¶å‘æ•°
```bash
/sim:batch --max-concurrent 4 *.inp
```
æœ€å¤šåŒæ—¶è¿è¡Œ 4 ä¸ªä½œä¸šã€‚

### ä¼˜å…ˆçº§è®¾ç½®
```bash
/sim:batch --priority high job1.inp --priority low job2.inp,job3.inp
```

---

## å¤šæ¨¡å‹åä½œ

**åä½œæ¨¡å¼**: Codex ä¸»å¯¼

| æ¨¡å‹ | èŒè´£ | è¾“å‡º |
|------|------|------|
| **Context7** | æä¾› ABAQUS æ‰¹é‡ä½œä¸šæ–‡æ¡£ | æœ€ä½³å®è·µ + ç¤ºä¾‹ |
| **Codex** | ç”Ÿæˆä½œä¸šè„šæœ¬ã€å‚æ•°æ‰«æé€»è¾‘ | Bash/SLURM è„šæœ¬ |
| **Claude** | é¢„æ£€ç´¢æ–‡æ¡£ã€éªŒè¯ INPã€æäº¤ä½œä¸šã€ç›‘æ§ | å®Œæ•´æ‰¹é‡æäº¤æµç¨‹ |

---

## é”™è¯¯å¤„ç†

| é”™è¯¯ç±»å‹ | å¤„ç†ç­–ç•¥ |
|----------|----------|
| INP æ–‡ä»¶éªŒè¯å¤±è´¥ | æ ‡è®°è¯¥ä½œä¸š,è¯¢é—®ç”¨æˆ·æ˜¯å¦è·³è¿‡æˆ–ä¿®å¤ |
| èµ„æºä¸è¶³ | å»ºè®®å‡å°‘å¹¶å‘æ•°æˆ–è°ƒæ•´èµ„æºé…ç½® |
| HPC æäº¤å¤±è´¥ | é™çº§åˆ°æœ¬åœ°é˜Ÿåˆ—æˆ–æç¤ºæ£€æŸ¥ HPC é…ç½® |
| ä½œä¸šè¶…æ—¶ | è®°å½•æ—¥å¿—,å»ºè®®å¢åŠ æ—¶é—´é™åˆ¶æˆ–ä¼˜åŒ–æ¨¡å‹ |

---

## å®‰å…¨æœºåˆ¶

1. **Datacheck éªŒè¯**: æäº¤å‰å¼ºåˆ¶è¿›è¡Œ ABAQUS datacheck
2. **èµ„æºé™åˆ¶**: é™åˆ¶å¹¶å‘ä½œä¸šæ•°,é¿å…ç³»ç»Ÿè¿‡è½½
3. **è¶…æ—¶è®¾ç½®**: ä¸ºæ¯ä¸ªä½œä¸šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
4. **æ—¥å¿—è®°å½•**: å®Œæ•´è®°å½•ä½œä¸šæäº¤ã€è¿è¡Œã€å®ŒæˆçŠ¶æ€
5. **ç¡®è®¤é—¨æ§**: high é£é™©,å¿…é¡»ç”¨æˆ·æ˜ç¡®ç¡®è®¤åæ‰§è¡Œ

---

## å‚è€ƒ

- å…±äº«åè®®: `.claude/commands/research/_protocol.md`
- èƒ½åŠ›é…ç½®: `.claude/.research/capabilities.yaml`
- è„šæœ¬ä¿®æ”¹: `/sim:modify`
- è°ƒè¯•è¯Šæ–­: `/sim:debug`
- ç»“æœæå–: `/sim:odb`
